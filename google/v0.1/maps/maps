args = args || {};
jsClientApi({
	name: "google.maps",
	data: {
		width: args.width || '100%',
		height: args.height || '300px'
	},
	initialize: function(callback) {
		//load the js from google maps
		$('body').append('<script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false&callback=' + callback + '""></script>')
	},
	loaded: function() {
	},
	create: function(jsapi) {
		var elem = document.getElementById('map-' + this.data.pid);
        var options = {
            center: new google.maps.LatLng(37.7699298, -122.4469157),
            zoom: 2,
            mapTypeId: google.maps.MapTypeId.ROADMAP
        }
        this.map = new google.maps.Map(elem, options);
        var self = this;
		setTimeout(function() {self.ready(jsapi)}, 400);
		return false;
	},
	ready: function(jsapi) {
		jsapi.ready();
	},
	interface: {
		center: function(opts) {
			var self = this;
            var geocoder = new google.maps.Geocoder();
            if (typeof opts == 'string')
				opts = {address:opts}
			if (opts.lat !== undefined && opts.lng !== undefined)
				opts.address = {lat:opts.lat, lng:opts.lng}
            if (typeof opts.address == 'object' && opts.address.lat && opts.address.lng)
				opts.address = opts.address.lat + ',' + opts.address.lng
            geocoder.geocode(
            	{ 'address': opts.address },
            	function(results, status) {
	                if (status == google.maps.GeocoderStatus.OK)
						self.map.setCenter(results[0].geometry.location);
	                else
	                	alert("Geocode was not successful for the following reason: " + status);
            	}
            );
		},
		zoom: function(level) {
			this.map.setZoom(parseInt(level));
		},
		streetview: function() {
			this.map.getStreetView();
		},
		addMarker: function(opts) {
			var self = this;
			var geocoder = new google.maps.Geocoder();
			if (typeof opts == 'string')
				opts = {address:opts}
			if (opts.lat !== undefined && opts.lng !== undefined)
				opts.address = {lat:opts.lat, lng:opts.lng}
			if (typeof opts.address == 'object' && opts.address.lat !== undefined && opts.address.lng !== undefined)
				opts.address = opts.address.lat + ',' + opts.address.lng
			geocoder.geocode({ 'address': opts.address }, function(results, status) {
				if (status == google.maps.GeocoderStatus.OK) {
					var marker_options = {
						map: self.map,
						position: results[0].geometry.location,
						title: opts.title,
						icon: opts.icon
					};
					var marker = new google.maps.Marker(marker_options);
				}
			});
		}
	}
}, {
	view: '<style>.gmapsapi img { max-width: none !important; }</style><div id="map-<%= data.pid %>" class="gmapsapi" style="width: <%= data.width %>; height: <%= data.height %>;"></div>'
})